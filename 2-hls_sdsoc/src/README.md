# SqueezeJet-2 SDSoC C/C++ project description

## About

This project is the SDSoC C/C++ implementation of the CNNs used in the Matlab project. Using the parameter, the input image, and the inter-layer result binary files generated in Matlab, this project runs the forward pass of a specific CNN and measures the time required by each layer and eventually the whole network. Additionally, it checks the produced inter-layer results against those generated by Caffe/Ristretto. 

The binary files (`1-parameter_generation/matlab/Binary_Files/`) are copied from the Matlab project to this project's `data` folder. Also, don't forget to copy the `1-parameter_generation/matlab/Labels/class_labels.txt` file in this project's `data` folder for printing the class labels in output.

In the `sqj2_tb.cpp` file, the user can uncomment the desired CNN to test. Each `test_<cnn>.cpp` file executes 3 (or 2 in the case of FLP HW implementation) implementations of the specific CNN. These are:

* the floating-point 
* the software (SW) fixed-point
* the hardware (HW) fixed-point

The aforementioned implementations correspond to the ones of the Matlab project.


## Build as simple C/C++ programs and test on a CPU

The project can be built by means of a Makefile. E.g.:
```
make clean; make
```
and executed with
```
./sqj2_tb.exe 0.0000001
```

The argument corresponds to the maximum result difference between the Caffe/Ristretto and the C/C++ implementations.

The HW implementations of the convolutional, the max-pooling, and the merged conv-maxpool layers are given in the `hw_conv_*.cpp`, the `hw_maxpool_*.cpp`, and the `hw_conv_mpool_*.cpp` files respectively.


## Build as HLS C/C++ descriptions in SDSoC 2018.2 and test them on Zynq FPGA SoC

After the `cnn-grinder` (the name is user defined) Linux application project has been created, the user must copy the `src` folder contents to the `src` folder of the SDSoC folder.

In the SDSoC tool the user must:

(1) Set the Active Build Configuration to `Release`.

(2) Change the following `cnn-grinder` project properties:

* Go to `C/C++ Build -> SDS++ Compiler -> Symbols` and add the following symbols:
	* `USEDEBUG` for viewing results in the output
	* `TRACE` for getting SDSoC HW traces
	* `USE_AFI` for selecting SDSoC memory allocation and system ports
	* `ULTRA96` for building for an UltraScale FPGA SoC

* Go to `C/C++ Build -> SDS++ Compiler -> Optimization` and set the following:
	* Optimization Level: `Optimize most (-O3)`
	* Other optimization flags: `-std=c++0x -Wno-unused-label`

* Go to `C/C++ Build -> SDS++ Compiler -> Directories` and add the following directory:
	* `"../src/include"`

(3) Select the desired "HW" function for acceleration, e.g. expand the `hw_conv_mpool_dfp.cpp` file and select the `hw_conv_mpool_dfp()` function for acceleration - right-click on the function and select `Toggle HW/SW`.

(4) Set the desired frequency for the accelerator and the data-mover.

(5) Right-click on the project and select `Build`.